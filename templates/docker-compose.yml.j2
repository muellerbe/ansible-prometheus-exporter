---
version: '2'
services:
{% if prometheus_exporter_cadvisor_enable|bool and (prometheus_exporter_cadvisor_groupname in group_names or prometheus_exporter_cadvisor_groupname == 'all') %}
  cadvisor:
    restart: unless-stopped
    image: "{{ prometheus_exporter_cadvisor_image }}"
    entrypoint: "/usr/bin/cadvisor -http_auth_file=/etc/htpasswd.cadvisor"
    volumes:
      - "/etc/hosts:/etc/hosts:ro"
      - "{{ prometheus_exporter_configuration_directory }}/cadvisor/htpasswd.cadvisor:/etc/htpasswd.cadvisor:ro"
      - "/:/rootfs:ro"
      - "/var/run:/var/run:rw"
      - "/sys:/sys:ro"
      - "/var/lib/docker/:/var/lib/docker:ro"
      - "/dev/disk/:/dev/disk:ro"
    ports:
      - "{{ prometheus_exporter_cadvisor_host }}:{{ prometheus_exporter_cadvisor_port }}:8080"
{% endif %}

{% if prometheus_exporter_mariadb_enable|bool and (prometheus_exporter_mariadb_groupname in group_names or prometheus_exporter_mariadb_groupname == 'all') %}
  mariadb:
    restart: unless-stopped
    image: "{{ prometheus_exporter_mariadb_image }}"
    entrypoint: "/bin/mysqld_exporter -collect.binlog_size=true -collect.info_schema.processlist=true"
    volumes:
      - "/etc/hosts:/etc/hosts:ro"
      - "{{ prometheus_exporter_configuration_directory }}/mariadb/my.cnf:/root/.my.cnf:ro"
    ports:
      - "{{ prometheus_exporter_mariadb_host }}:{{ prometheus_exporter_mariadb_port }}:9104"
{% endif %}
